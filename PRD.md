# 제품 요구사항 문서 (PRD): 결제 시스템 시뮬레이터

## 1. 소개

### 1.1 목적
결제 시스템 시뮬레이터는 부산은행의 전자상거래 및 금융 거래 워크플로우를 모방하는 **백엔드 애플리케이션**으로, 실시간 결제 처리와 트랜잭션 관리를 시뮬레이션합니다. 이 프로젝트는 **Java**, **Kotlin**, **Spring Boot**를 활용한 REST API 개발 실습을 통해 백엔드 개발 역량을 강화하고, 부산은행 백엔드 개발자 직무 지원을 위한 포트폴리오로 활용됩니다. 사용자 인증, 결제 처리, 트랜잭션 상태 관리 기능을 구현하여 금융 시스템의 핵심 로직을 학습합니다.

### 1.2 범위
시뮬레이터는 다음을 포함합니다:
- 결제 시작, 확인, 상태 조회를 위한 **RESTful API**.
- **JWT 기반 인증**으로 결제 작업 보안.
- **Oracle** 또는 **H2** 데이터베이스를 사용한 트랜잭션 관리.
- 결제 실패 시 오류 처리 및 사용자 피드백.
- **Swagger**와 **JUnit**을 활용한 API 테스트 및 문서화.

다음은 제외됩니다:
- 실제 결제 게이트웨이(예: NICE Payments) 연동.
- 프론트엔드 인터페이스(백엔드 API 초점).
- 환불, 다중 통화 등 고급 결제 기능.

### 1.3 대상 사용자
- **주요 사용자**: 박건우(개발자 본인), 부산은행 채용 담당자.
- **사용 사례**: Java, Kotlin, Spring Boot, REST API 설계, 금융 시스템 로직 숙련도를 입증하며, 부산은행의 백엔드 개발자 직무 지원 시 포트폴리오로 활용.

## 2. 목표 및 목적

### 2.1 목표
- 금융 결제 워크플로우를 시뮬레이션하는 백엔드 시스템 구축.
- Java, Kotlin, Spring Boot, Oracle, AWS 기술 실습 경험 확보.
- REST API 설계, 오류 처리, 테스트 역량을 포트폴리오로 증명.

### 2.2 목적
- 최소 3개의 REST API 엔드포인트(인증, 결제, 상태 조회) 구현.
- JUnit과 Postman으로 API 테스트 커버리지 90% 이상 달성.
- GitHub README와 Swagger로 API 문서화 완료.
- 동시성 처리(트랜잭션 충돌 시뮬레이션) 구현.

## 3. 기능 요구사항

### 3.1 사용자 인증
- **설명**: 결제 시작 전 사용자 인증으로 보안 접근 보장.
- **기능**:
  - `POST /auth/login`: 자격 증명으로 JWT 토큰 생성.
  - **Spring Security**로 결제 API 보호.
- **수용 기준**:
  - 유효한 자격 증명: 1시간 만료 JWT 토큰 반환.
  - 유효하지 않은 자격 증명: 401 Unauthorized 오류.
  - 토큰 없는 요청: 403 Forbidden 오류.

### 3.2 결제 시작
- **설명**: 가상 계좌 간 결제 요청 시작.
- **기능**:
  - `POST /payment/init`: 금액, 계좌 ID로 결제 요청 생성.
  - 금액(양수) 및 계좌 잔액 검증.
  - 트랜잭션 상태(PENDING)로 **Oracle/H2** 저장.
- **수용 기준**:
  - 성공: 트랜잭션 ID와 201 Created 응답.
  - 유효하지 않은 입력(음수 금액): 400 Bad Request.
  - 트랜잭션 PENDING 상태로 저장.

### 3.3 결제 확인
- **설명**: 결제 성공/실패 시뮬레이션 및 상태 업데이트.
- **기능**:
  - `POST /payment/confirm/{transactionId}`: 결제 확인.
  - 잔액 검증 후 상태(SUCCESS/FAILED) 업데이트.
  - 실패 시 트랜잭션 롤백.
- **수용 기준**:
  - 성공: SUCCESS 상태, 200 OK 응답.
  - 실패: FAILED 상태, 롤백, 400 Bad Request.
  - 존재하지 않는 ID: 404 Not Found.

### 3.4 결제 상태 조회
- **설명**: 결제 상태 및 세부 정보 조회.
- **기능**:
  - `GET /payment/status/{transactionId}`: 트랜잭션 정보 조회.
  - 반환: ID, 금액, 상태, 타임스탬프.
- **수용 기준**:
  - 유효한 ID: 세부 정보, 200 OK 응답.
  - 유효하지 않은 ID: 404 Not Found.
  - 사용자 친화적 상태 정보 포함.

### 3.5 데이터베이스 관리
- **설명**: 사용자 및 결제 데이터 관리.
- **기능**:
  - **JPA**로 Oracle/H2에 데이터 저장.
  - 테이블: `users` (id, username, password_hash), `accounts` (account_id, user_id, balance), `transactions` (transaction_id, account_id, amount, status, timestamp).
- **수용 기준**:
  - 스키마: 필드 및 관계 지원.
  - JPA: CRUD 작업 처리.
  - 트랜잭션 격리로 데이터 무결성 보장.

## 4. 비기능 요구사항

### 4.1 성능
- 정상 부하에서 API 응답 200ms 이내.
- 10개 동시 결제 요청 오류 없이 처리.

### 4.2 보안
- 비밀번호 **bcrypt** 해시 처리.
- 결제 API JWT 보호.
- 입력 검증으로 SQL 인젝션 방지.

### 4.3 확장성
- 트랜잭션 ID 인덱싱으로 스키마 최적화.
- **Spring Boot** 스레드 풀로 동시 요청 처리.

### 4.4 유지보수성
- 클린 코드 원칙 준수.
- README, 인라인 주석, **Swagger** 문서화.

### 4.5 테스트
- **JUnit**으로 서비스/컨트롤러 테스트(90% 커버리지).
- **Postman**으로 통합 테스트.
- 오류 시나리오(유효하지 않은 토큰, 결제 실패) 테스트.

## 5. 기술 스택
- **언어**: Java, Kotlin
- **프레임워크**: Spring Boot
- **인증**: Spring Security with JWT
- **데이터베이스**: Oracle (포트폴리오), H2 (로컬)
- **ORM**: JPA (Hibernate)
- **테스트**: JUnit, Postman
- **문서화**: Swagger, GitHub README
- **인프라**: AWS EC2 (배포), Docker
- **버전 관리**: Git

## 6. 사용자 스토리

1. **사용자로서**, 로그인하여 결제 기능을 안전하게 사용.
   - 수용 기준: JWT 토큰 수령, 유효하지 않은 자격 증명 오류.
2. **사용자로서**, 결제를 시작하여 프로세스 진행.
   - 수용 기준: PENDING 상태 생성, 유효하지 않은 입력 거부.
3. **사용자로서**, 결제를 확인하여 완료.
   - 수용 기준: SUCCESS/FAILED 업데이트, 실패 시 롤백.
4. **사용자로서**, 결제 상태를 확인하여 결과 확인.
   - 수용 기준: 세부 정보 조회, 유효하지 않은 ID 오류.

## 7. 가정 및 제약

### 7.1 가정
- 사용자는 API 사용 지식 보유(Postman 등).
- 모의 계좌 및 잔액 데이터로 시뮬레이션 충분.
- 로컬은 H2, Oracle은 포트폴리오용.

### 7.2 제약
- 백엔드 초점(프론트엔드 제외).
- 단일 개발자, 2-4주 타임라인.
- 환불, 다중 통화 미지원.

## 8. 위험 및 완화

- **위험**: JWT 인증 구현 복잡성.
  - **완화**: Spring Security 문서 활용, 점진적 테스트.
- **위험**: 트랜잭션 동시성 문제.
  - **완화**: JPA 격리 설정, 동시 요청 테스트.
- **위험**: 테스트 커버리지 부족.
  - **완화**: JaCoCo로 커버리지 확인, 테스트 병행.

## 9. 마일스톤 및 타임라인

- **1주차**: 프로젝트 설정, 인증 API, 데이터베이스 스키마.
- **2주차**: 결제 시작/확인 API, JPA 통합.
- **3주차**: 상태 조회 API, 테스트, 오류 처리.
- **4주차**: Swagger 문서화, AWS 배포, README.

## 10. 성공 지표

- 모든 사용자 스토리 구현 및 수용 기준 통과.
- API 테스트 커버리지 90%, 10개 동시 요청 처리.
- GitHub에 AWS 배포 지침 포함 문서화.
- Java, Kotlin, 금융 시스템 역량 포트폴리오 반영.

## 11. 향후 개선

- **CURL**로 모의 결제 게이트웨이 연동.
- Kafka로 비동기 결제 처리.
- 재시도 메커니즘 및 분석 대시보드 추가.

---

**작성자**: 박건우  
**버전**: 1.0  
**날짜**: 2025-05-10  
**리포지토리**: [PaymentSimulator-Java-Kotlin, 링크 추가 예정]
